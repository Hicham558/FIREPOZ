je<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scanner de Code-Barres</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
        }
        #scanner-container {
            width: 100%;
            max-width: 640px;
            margin: 0 auto;
        }
        #scanner-video {
            width: 100%;
            border: 2px solid #ccc;
        }
        #result {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            min-height: 100px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            margin: 10px;
            cursor: pointer;
        }
        .error {
            color: red;
        }
    </style>
</head>
<body>
    <h1>Scanner de Code-Barres</h1>
    <nav>
        <a href="index.html">Accueil</a>
        <a href="page1.html">Scanner Produits</a>
    </nav>
    <div id="scanner-container">
        <video id="scanner-video" autoplay muted playsinline></video>
    </div>
    <button onclick="startScanner()">Démarrer le Scan</button>
    <button onclick="stopScanner()">Arrêter le Scan</button>
    <div id="result">Résultat du scan : Aucun scan effectué.</div>

    <!-- Inclure QuaggaJS depuis un CDN -->
    <script src="https://cdn.jsdelivr.net/npm/quagga@0.12.1/dist/quagga.min.js"></script>
    <script>
        let scannerRunning = false;

        function startScanner() {
            if (scannerRunning) return;
            scannerRunning = true;

            // Initialiser QuaggaJS
            Quagga.init({
                inputStream: {
                    name: "Live",
                    type: "LiveStream",
                    target: document.querySelector('#scanner-video'),
                    constraints: {
                        facingMode: "environment" // Utiliser la caméra arrière
                    }
                },
                decoder: {
                    readers: ["ean_reader", "code_128_reader", "ean_8_reader"] // Types de codes-barres pris en charge
                }
            }, function(err) {
                if (err) {
                    document.getElementById('result').innerHTML = `<span class="error">Erreur : ${err}</span>`;
                    console.error(err);
                    return;
                }
                Quagga.start();
            });

            // Événement déclenché lorsqu'un code-barres est détecté
            Quagga.onDetected(function(data) {
                const code = data.codeResult.code;
                document.getElementById('result').innerHTML = `Code-barres détecté : ${code}<br>Recherche des informations...`;
                fetchProduit(code);
                // Arrêter le scan après détection (optionnel, commenté pour permettre plusieurs scans)
                // stopScanner();
            });
        }

        function stopScanner() {
            if (!scannerRunning) return;
            Quagga.stop();
            scannerRunning = false;
            document.getElementById('result').innerHTML = "Scan arrêté. Cliquez sur 'Démarrer le Scan' pour recommencer.";
        }

        async function fetchProduit(barCode) {
            try {
                // Remplacer par l'URL de ton API
                const response = await fetch('https://web-production-3b9e.up.railway.app/liste_produits');
                const produits = await response.json();

                // Chercher le produit correspondant au code-barres
                const produit = produits.find(p => p.BAR === barCode);

                if (produit) {
                    document.getElementById('result').innerHTML = `
                        <strong>Produit trouvé :</strong><br>
                        Désignation : ${produit.DESIGNATION}<br>
                        Quantité : ${produit.QTE}<br>
                        Prix : ${produit.PRIX} €<br>
                        Code-barres : ${produit.BAR}
                    `;
                } else {
                    document.getElementById('result').innerHTML = `<span class="error">Aucun produit trouvé pour le code-barres : ${barCode}</span>`;
                }
            } catch (error) {
                document.getElementById('result').innerHTML = `<span class="error">Erreur lors de la récupération des données : ${error}</span>`;
            }
        }
    </script>
</body>
</html>