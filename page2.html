chargerVentesJour(date, client, utilisateur);
            chargerAchatsJour(date, utilisateur, fournisseur);
            chargerArticlesPlusVendus(date, client, utilisateur);
            chargerProfit(date, client, utilisateur);
        }

        document.addEventListener('DOMContentLoaded', async () => {
            console.log('Initialisation de la page...');
            const userId = localStorage.getItem('userId');
            const userEmail = localStorage.getItem('userEmail');

            if (!userId) {
                showToast('Veuillez vous connecter', true);
                window.location.href = 'index.html';
                return;
            }

            document.getElementById('userDisplay').textContent = `Connecté: ${userEmail}`;
            document.getElementById('userDisplay').classList.remove('hidden');
            document.getElementById('loginLogoutButton').innerHTML = '<i class="fas fa-sign-out-alt mr-1"></i>Déconnexion';

            flatpickr('#dateFilter', {
                dateFormat: 'Y-m-d',
                defaultDate: new Date(),
                onChange: (selectedDates, dateStr) => {
                    reloadData();
                }
            });

            document.getElementById('clientFilter').addEventListener('change', reloadData);
            document.getElementById('fournisseurFilter').addEventListener('change', reloadData);
            document.getElementById('userFilter').addEventListener('change', reloadData);

            try {
                await Promise.all([
                    chargerClients(),
                    chargerFournisseurs(),
                    chargerUtilisateurs(),
                    chargerStockValue(),
                    reloadData()
                ]);
            } catch (error) {
                console.error('Erreur lors de l’initialisation:', error);
                showToast('Erreur lors de l’initialisation: ' + error.message, true);
            }
        });
    </script>
</body>
</html>