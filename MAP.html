<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FirePoz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <style>
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        .animate-fade-in { animation: fadeIn 0.8s ease-out forwards; }
        .animate-pulse { animation: pulse 2s infinite ease-in-out; }
        #mapContainer { height: 400px; width: 100%; border: 2px solid #e5e7eb; border-radius: 8px; }
        .client-pin { color: #3b82f6; }
        .supplier-pin { color: #ef4444; }
        nav { box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); }
        .table-container { max-height: 300px; overflow-y: auto; position: relative; }
        .table-container table { width: 100%; }
        .table-container thead { position: sticky; top: 0; background: #f9fafb; z-index: 1; }
        .action-button { transition: background-color 0.3s ease; }
        .action-button:hover { background-color: #e5e7eb; }
        .tab { cursor: pointer; }
        .tab.active { border-bottom: 2px solid #3b82f6; color: #3b82f6; }
    </style>
</head>
<body class="bg-gray-100">
    <!-- Navigation -->
    <nav class="bg-indigo-600 text-white p-2 fixed w-full top-0 z-30 animate-fade-in">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex flex-col">
                <h1 class="text-xl font-bold flex items-center">
                    <i class="fas fa-fire mr-2 text-amber-400 animate-pulse"></i> FirePoz
                </h1>
                <span id="userDisplay" class="text-xs hidden"></span>
            </div>
            <div class="space-x-4 flex items-center">
                <a href="index.html" class="hover:text-indigo-200 transition flex items-center text-sm">
                    <i class="fas fa-home mr-1"></i> Tableau de Bord
                </a>
                <button id="loginLogoutButton" onclick="loginLogout()" class="bg-red-500 text-white px-2 py-1 rounded-md hover:bg-red-600 transition flex items-center text-sm">
                    <i class="fas fa-sign-out-alt mr-1"></i>Déconnexion
                </button>
            </div>
        </div>
    </nav>

    <!-- Formulaire de connexion -->
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-40 hidden animate-fade-in">
        <form id="loginForm" class="bg-white rounded-lg p-6 w-full max-w-md">
            <h2 class="text-xl font-semibold mb-4">Connexion</h2>
            <p class="text-sm text-red-500 mb-4">⚠️ Le mot de passe ne doit pas être celui de votre email.</p>
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-1">Adresse Email*</label>
                <input type="text" id="userEmail" name="username" autocomplete="username" class="w-full px-3 py-2 border rounded-md" placeholder="Entrez votre email" required>
            </div>
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-1">Mot de passe*</label>
                <input type="password" id="userPassword" name="password" autocomplete="current-password" class="w-full px-3 py-2 border rounded-md" placeholder="Entrez votre mot de passe" required>
            </div>
            <div class="flex justify-end space-x-3">
                <button type="submit" onclick="loginWithCredentials(event)" class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 transition">
                    <i class="fas fa-sign-in-alt mr-2"></i>Se connecter
                </button>
            </div>
        </form>
    </div>

    <!-- Contenu principal -->
    <div class="container mx-auto px-4 py-12 mt-12">
        <!-- Carte -->
        <div id="mapContainer" class="mb-4 animate-fade-in"></div>

        <!-- Champs cachés -->
        <input type="text" id="entityName" class="hidden">
        <input type="text" id="entityAddress" class="hidden">

        <!-- Onglets -->
        <div class="flex space-x-4 mb-4">
            <div id="tabClients" class="tab text-lg font-semibold text-gray-600 pb-2 active" onclick="switchTab('clients')">Clients</div>
            <div id="tabSuppliers" class="tab text-lg font-semibold text-gray-600 pb-2" onclick="switchTab('suppliers')">Fournisseurs</div>
        </div>

        <!-- Liste des clients -->
        <div id="clientsSection" class="bg-white rounded-lg shadow-md p-6 animate-fade-in">
            <div class="relative mb-4">
                <input type="text" id="searchClient" placeholder="Rechercher clients..." class="w-full pl-10 pr-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
            </div>
            <div class="table-container">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Action</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nom</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Solde</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Adresse</th>
                        </tr>
                    </thead>
                    <tbody id="clientsList" class="bg-white divide-y divide-gray-200">
                        <tr>
                            <td colspan="4" class="text-center py-4 text-gray-500">Chargement en cours...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Liste des fournisseurs -->
        <div id="suppliersSection" class="bg-white rounded-lg shadow-md p-6 animate-fade-in hidden">
            <div class="relative mb-4">
                <input type="text" id="searchSupplier" placeholder="Rechercher fournisseurs..." class="w-full pl-10 pr-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
            </div>
            <div class="table-container">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Action</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nom</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Solde</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Adresse</th>
                        </tr>
                    </thead>
                    <tbody id="suppliersList" class="bg-white divide-y divide-gray-200">
                        <tr>
                            <td colspan="4" class="text-center py-4 text-gray-500">Chargement en cours...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-4 right-4 hidden">
        <div class="flex items-center px-6 py-3 rounded-md shadow-lg">
            <i id="toastIcon" class="mr-2"></i>
            <span id="toastMessage"></span>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'https://web-production-3b9e.up.railway.app';
        let map, marker;
        let currentEntityId = null;
        let currentEntityType = null;
        let selectedPosition = null;
        let clients = [];
        let suppliers = [];

        // Vérification initiale
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Page map.html chargée');
            const userId = localStorage.getItem('userId');
            const userEmail = localStorage.getItem('userEmail');
            if (userId && userEmail) {
                document.getElementById('userDisplay').textContent = userEmail.toLowerCase();
                document.getElementById('userDisplay').classList.remove('hidden');
                document.getElementById('loginLogoutButton').innerHTML = '<i class="fas fa-sign-out-alt mr-1"></i>Déconnexion';
                document.getElementById('loginModal').classList.add('hidden');
                initMap();
                loadEntities();
            } else {
                document.getElementById('loginLogoutButton').innerHTML = '<i class="fas fa-sign-in-alt mr-1"></i>Connexion';
                document.getElementById('loginModal').classList.remove('hidden');
                document.getElementById('clientsList').innerHTML = '<tr><td colspan="4" class="text-center py-4 text-gray-500">Veuillez vous connecter</td></tr>';
                document.getElementById('suppliersList').innerHTML = '<tr><td colspan="4" class="text-center py-4 text-gray-500">Veuillez vous connecter</td></tr>';
            }
        });

        // Connexion
        function loginWithCredentials(event) {
            event.preventDefault();
            const email = document.getElementById('userEmail').value.trim();
            const password = document.getElementById('userPassword').value.trim();
            if (!email || !password) {
                showToast('Veuillez entrer un email et un mot de passe', true);
                return;
            }
            const userId = btoa(`${email.toLowerCase()}:${password}`);
            localStorage.setItem('userId', userId);
            localStorage.setItem('userEmail', email.toLowerCase());
            document.getElementById('userDisplay').textContent = email.toLowerCase();
            document.getElementById('userDisplay').classList.remove('hidden');
            document.getElementById('loginLogoutButton').innerHTML = '<i class="fas fa-sign-out-alt mr-1"></i>Déconnexion';
            document.getElementById('loginModal').classList.add('hidden');
            initMap();
            loadEntities();
            showToast('Connexion réussie');
        }

        // Déconnexion
        function loginLogout() {
            if (localStorage.getItem('userId')) {
                localStorage.removeItem('userId');
                localStorage.removeItem('userEmail');
                document.getElementById('userDisplay').textContent = '';
                document.getElementById('userDisplay').classList.add('hidden');
                document.getElementById('loginLogoutButton').innerHTML = '<i class="fas fa-sign-in-alt mr-1"></i>Connexion';
                document.getElementById('loginModal').classList.remove('hidden');
                if (map) map.remove();
                map = null;
                document.getElementById('clientsList').innerHTML = '<tr><td colspan="4" class="text-center py-4 text-gray-500">Veuillez vous connecter</td></tr>';
                document.getElementById('suppliersList').innerHTML = '<tr><td colspan="4" class="text-center py-4 text-gray-500">Veuillez vous connecter</td></tr>';
                showToast('Déconnexion réussie');
            }
        }

        // Initialiser la carte
        function initMap(lat = 36.7538, lng = 3.0588, zoom = 6) {
            if (!document.getElementById('mapContainer')) {
                console.error('Conteneur de carte introuvable');
                showToast('Erreur: Conteneur de carte manquant', true);
                return;
            }
            if (map) map.remove();
            map = L.map('mapContainer', {
                zoomControl: false,
                attributionControl: false
            }).setView([lat, lng], zoom);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19
            }).addTo(map);
            map.on('click', function(e) {
                const { lat, lng } = e.latlng;
                selectedPosition = { lat, lng };
                let address = document.getElementById('entityAddress').value.trim();
                const { cleanAddress } = decodePositionFromAddress(address);
                const newAddress = `${cleanAddress || 'Nouvelle adresse'}|${lat.toFixed(6)},${lng.toFixed(6)}`;
                document.getElementById('entityAddress').value = newAddress;
                setMarker(lat, lng, cleanAddress || 'Nouvelle adresse', document.getElementById('entityName').value.trim());
                console.log(`Position sélectionnée: ${lat.toFixed(6)}, ${lng.toFixed(6)}, adresse mise à jour: ${newAddress}`);
            });
            console.log('Carte initialisée à', lat, lng);
        }

        // Placer une épingle
        function setMarker(lat, lng, address, name = '') {
            if (!map) {
                console.error('Carte non initialisée');
                return;
            }
            if (marker) marker.remove();
            marker = L.marker([lat, lng], {
                icon: L.divIcon({
                    className: currentEntityType === 'client' ? 'client-pin' : 'supplier-pin',
                    html: `<i class="fas fa-map-marker-alt fa-2x"></i>`,
                    iconSize: [30, 30],
                    iconAnchor: [15, 30]
                })
            }).addTo(map);
            // Inclure le nom et l'adresse dans le popup
            const popupContent = `${name ? `<b>Nom: ${name}</b><br>` : ''}Adresse: ${address || 'Non définie'}`;
            marker.bindPopup(popupContent);
            map.panTo([lat, lng], { animate: true, duration: 1 });
            console.log(`Épingle placée à ${lat}, ${lng}, nom: ${name}, adresse: ${address}`);
        }

        // Afficher les notifications
        function showToast(message, isError = false) {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            const toastIcon = document.getElementById('toastIcon');
            if (!toast || !toastMessage || !toastIcon) {
                console.error('Éléments toast introuvables');
                return;
            }
            toast.className = isError
                ? 'fixed bottom-4 right-4 flex items-center bg-red-500 text-white px-6 py-3 rounded-md shadow-lg'
                : 'fixed bottom-4 right-4 flex items-center bg-green-500 text-white px-6 py-3 rounded-md shadow-lg';
            toastIcon.className = isError
                ? 'fas fa-exclamation-circle mr-2'
                : 'fas fa-check-circle mr-2';
            toastMessage.textContent = message;
            toast.classList.remove('hidden');
            setTimeout(() => {
                toast.classList.add('hidden');
            }, 3000);
        }

        // Gérer les onglets
        function switchTab(tab) {
            const clientsTab = document.getElementById('tabClients');
            const suppliersTab = document.getElementById('tabSuppliers');
            const clientsSection = document.getElementById('clientsSection');
            const suppliersSection = document.getElementById('suppliersSection');

            if (tab === 'clients') {
                clientsTab.classList.add('active');
                suppliersTab.classList.remove('active');
                clientsSection.classList.remove('hidden');
                suppliersSection.classList.add('hidden');
            } else {
                clientsTab.classList.remove('active');
                suppliersTab.classList.add('active');
                clientsSection.classList.add('hidden');
                suppliersSection.classList.remove('hidden');
            }
        }

        // Charger les entités
        async function loadEntities() {
            const userId = localStorage.getItem('userId');
            if (!userId) {
                showToast('Veuillez vous connecter pour charger les entités', true);
                return;
            }
            try {
                console.log('Tentative de chargement des clients...');
                const clientResponse = await fetch(`${API_BASE_URL}/liste_clients`, {
                    headers: { 'X-User-ID': userId }
                });
                console.log('Statut clients:', clientResponse.status, clientResponse.statusText);
                if (!clientResponse.ok) throw new Error(`Erreur chargement clients: ${clientResponse.statusText}`);
                clients = await clientResponse.json();
                console.log('Données clients:', clients);
                updateClientList(clients);

                console.log('Tentative de chargement des fournisseurs...');
                const supplierResponse = await fetch(`${API_BASE_URL}/liste_fournisseurs`, {
                    headers: { 'X-User-ID': userId }
                });
                console.log('Statut fournisseurs:', supplierResponse.status, supplierResponse.statusText);
                if (!supplierResponse.ok) throw new Error(`Erreur chargement fournisseurs: ${supplierResponse.statusText}`);
                suppliers = await supplierResponse.json();
                console.log('Données fournisseurs:', suppliers);
                updateSupplierList(suppliers);

                console.log('Entités chargées:', clients.length, 'clients,', suppliers.length, 'fournisseurs');
            } catch (error) {
                showToast('Erreur de chargement des entités: ' + error.message, true);
                console.error('Erreur chargement entités:', error);
                document.getElementById('clientsList').innerHTML = `<tr><td colspan="4" class="text-center py-4 text-red-500">Erreur: ${error.message}</td></tr>`;
                document.getElementById('suppliersList').innerHTML = `<tr><td colspan="4" class="text-center py-4 text-red-500">Erreur: ${error.message}</td></tr>`;
            }
        }

        // Mettre à jour la liste des clients
        function updateClientList(clients) {
            const tbody = document.getElementById('clientsList');
            if (!tbody) return;
            if (clients.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" class="text-center py-4 text-gray-500">Aucun client trouvé</td></tr>';
                return;
            }
            tbody.innerHTML = '';
            clients.forEach(client => {
                const tr = document.createElement('tr');
                tr.className = 'hover:bg-gray-50';
                tr.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 flex space-x-2">
                        <button onclick="locateEntity('client', '${client.numero_clt || ''}', '${client.adresse || ''}', '${client.nom || ''}')" class="action-button p-2 rounded-full text-blue-600 hover:bg-gray-200" title="Repérer">
                            <i class="fas fa-map-marker-alt"></i>
                        </button>
                        <button onclick="confirmSaveClient('${client.numero_clt || ''}')" class="action-button p-2 rounded-full text-green-600 hover:bg-gray-200" title="Enregistrer">
                            <i class="fas fa-save"></i>
                        </button>
                        <button onclick="openGoogleMaps('${client.adresse || ''}')" class="action-button p-2 rounded-full text-purple-600 hover:bg-gray-200" title="Voir sur Google Maps">
                            <i class="fas fa-globe"></i>
                        </button>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${client.nom || 'N/A'}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${(client.solde || 0).toFixed(2)} DA</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${client.adresse || 'N/A'}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Mettre à jour la liste des fournisseurs
        function updateSupplierList(suppliers) {
            const tbody = document.getElementById('suppliersList');
            if (!tbody) return;
            if (suppliers.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" class="text-center py-4 text-gray-500">Aucun fournisseur trouvé</td></tr>';
                return;
            }
            tbody.innerHTML = '';
            suppliers.forEach(supplier => {
                const tr = document.createElement('tr');
                tr.className = 'hover:bg-gray-50';
                tr.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 flex space-x-2">
                        <button onclick="locateEntity('supplier', '${supplier.numero_fou || ''}', '${supplier.adresse || ''}', '${supplier.nom || ''}')" class="action-button p-2 rounded-full text-blue-600 hover:bg-gray-200" title="Repérer">
                            <i class="fas fa-map-marker-alt"></i>
                        </button>
                        <button onclick="confirmSaveSupplier('${supplier.numero_fou || ''}')" class="action-button p-2 rounded-full text-green-600 hover:bg-gray-200" title="Enregistrer">
                            <i class="fas fa-save"></i>
                        </button>
                        <button onclick="openGoogleMaps('${supplier.adresse || ''}')" class="action-button p-2 rounded-full text-purple-600 hover:bg-gray-200" title="Voir sur Google Maps">
                            <i class="fas fa-globe"></i>
                        </button>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${supplier.nom || 'N/A'}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${(supplier.solde || 0).toFixed(2)} DA</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 Parfois, les identifiants dans les données (`numero_clt` ou `numero_fou`) peuvent être des nombres ou des chaînes avec des espaces, tandis que l'identifiant passé via `onclick` est toujours une chaîne. Pour éviter les problèmes de correspondance, nous convertissons les deux côtés en chaînes et supprimons les espaces avec `trim()` dans les fonctions `confirmSaveClient` et `confirmSaveSupplier`.

2. **Ajout du nom dans le popup de la carte** :
   - La fonction `setMarker` a été modifiée pour accepter un paramètre `name` (avec une valeur par défaut vide pour éviter de casser les appels existants). Le contenu du popup inclut maintenant le nom de l'entité (en gras) suivi de l'adresse, si le nom est fourni. Cela s'applique à la fois lorsque l'utilisateur clique sur la carte (via `initMap`) et lorsque l'entité est repérée ou sauvegardée.

### Instructions pour tester

1. **Enregistrez le code** :
   - Copiez le code HTML ci-dessus dans votre fichier `map.html`.
   - Assurez-vous que l'API à l'adresse `https://web-production-3b9e.up.railway.app` est accessible et que les endpoints (`/liste_clients`, `/liste_fournisseurs`, `/modifier_client/:id`, `/modifier_fournisseur/:id`) renvoient des données valides.

2. **Testez le problème "Client introuvable"** :
   - Connectez-vous à l'application.
   - Chargez la liste des clients et fournisseurs.
   - Cliquez sur "Enregistrer" (icône verte) pour un client (par exemple, Hicham) sans cliquer sur "Repérer" au préalable.
   - Vérifiez que le message "Client introuvable" n'apparaît pas et que les données (nom et adresse) sont correctement chargées dans les champs `entityName` et `entityAddress`.
   - Répétez pour un fournisseur.

3. **Testez l'affichage du nom sur la carte** :
   - Cliquez sur "Repérer" (icône bleue) pour un client ou un fournisseur (par exemple, Omar).
   - Vérifiez que le popup du marqueur sur la carte affiche le nom (par exemple, "Nom: Omar" suivi de l'adresse).
   - Cliquez sur "Enregistrer" pour une autre entité (par exemple, Hicham) et vérifiez que le popup affiche le bon nom et la bonne adresse.
   - Cliquez sur la carte pour sélectionner une nouvelle position et vérifiez que le popup affiche le nom actuel (s'il est défini) et l'adresse mise à jour.

4. **Testez la sauvegarde** :
   - Cliquez sur "Repérer" pour un client (par exemple, Omar).
   - Sans cliquer sur "Repérer" pour un autre client, cliquez sur "Enregistrer" pour un autre client (par exemple, Hicham).
   - Vérifiez que les données sauvegardées via l'API correspondent à Hicham (et non à Omar).
   - Répétez pour les fournisseurs.

5. **Vérifiez les logs de la console** :
   - Ouvrez la console du navigateur (F12 → Console) pour voir les messages de débogage (par exemple, `console.log` dans `confirmSaveClient` ou `setMarker`).
   - Si une erreur persiste, vérifiez si les identifiants (`numero_clt` ou `numero_fou`) dans les données de l'API correspondent à ceux passés dans les boutons.

### Remarques importantes

- **Problèmes potentiels avec l'API** :
  - Si le problème "Client introuvable" persiste, il est possible que les données renvoyées par l'API aient des identifiants mal formatés (par exemple, `numero_clt` ou `numero_fou` manquants, null, ou avec des caractères spéciaux). Ajoutez un `console.log(clients)` ou `console.log(suppliers)` dans `loadEntities` pour inspecter les données.
  - Assurez-vous que l'API renvoie des identifiants uniques et cohérents.

- **Affichage du nom sur la carte** :
  - Le nom est maintenant inclus dans le popup du marqueur, mais uniquement si un nom est défini (par exemple, via `entityName.value` ou les données de l'entité). Si aucun nom n'est défini, seul l'adresse est affichée pour éviter un popup vide ou mal formaté.

- **Code inchangé** :
  - À part les modifications dans `setMarker`, `confirmSaveClient`, et `confirmSaveSupplier`, tout le reste du code (HTML, CSS, et autres fonctions JavaScript) est identique à votre version précédente.

Si vous rencontrez des problèmes lors des tests (par exemple, des erreurs d'API, des popups mal affichés, ou des comportements inattendus), partagez les détails (comme les messages d'erreur dans la console ou les données renvoyées par l'API), et je pourrai vous aider à déboguer davantage ! 😄