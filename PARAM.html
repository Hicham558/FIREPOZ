<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paramètres - Firepoz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #1a103d, #2a1a5e);
            font-family: 'Inter', sans-serif;
        }
        .card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }
        .glow {
            box-shadow: 0 0 15px rgba(124, 58, 237, 0.5);
        }
        .modal {
            transition: opacity 0.3s ease;
        }
        .input-field {
            background-color: #2d3748;
            border: none;
            color: #e2e8f0;
            padding: 0.5rem;
            border-radius: 0.375rem;
            width: 100%;
        }
        .input-field:focus {
            outline: none;
            ring: 2px;
            ring-color: #7c3aed;
        }
        .animate-fade-in {
            animation: fadeIn 0.8s ease-out forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .toast {
            transition: opacity 0.3s ease;
        }
        #cameraPreview {
            width: 100%;
            max-width: 300px;
            height: 200px;
            border: 2px solid #e5e7eb;
            margin-bottom: 1rem;
            display: none;
            background: #000;
        }
    </style>
</head>
<body class="min-h-screen text-gray-200">
    <!-- Navigation -->
    <nav class="bg-gray-900 p-4 shadow-lg animate-fade-in">
        <div class="container mx-auto flex justify-between items-center">
            <div class="text-2xl font-bold text-purple-400">
                <i class="fas fa-fire mr-2"></i> Firepoz
            </div>
            <div class="space-x-4">
                <a href="index.html" class="text-gray-300 hover:text-purple-400 transition">Tableau de bord</a>
                <a href="vente.html" class="text-gray-300 hover:text-purple-400 transition">Ventes</a>
                <a href="achat.html" class="text-gray-300 hover:text-purple-400 transition">Achats</a>
                <a href="HISTO.html" class="text-gray-300 hover:text-purple-400 transition">Versements</a>
                <a href="HELP.html" class="text-gray-300 hover:text-purple-400 transition">Aide</a>
                <a href="parametres.html" class="text-purple-400 font-semibold">Paramètres</a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mx-auto py-12 px-4 animate-fade-in">
        <div class="text-center mb-12">
            <h1 class="text-4xl font-bold text-purple-300">Paramètres de Firepoz</h1>
            <p class="text-lg text-gray-400 mt-2">
                Configurez votre application pour une expérience optimale.<br>
                Développé par <span class="text-purple-400 font-semibold">Khelladi Hicham</span>
            </p>
        </div>

        <!-- Settings Sections -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            <!-- General Settings -->
            <div class="card bg-gray-800 p-6 rounded-lg glow">
                <h2 class="text-2xl font-semibold text-gray-100 mb-4">
                    <i class="fas fa-cog mr-2 text-purple-400"></i> Paramètres Généraux
                </h2>
                <form id="generalSettingsForm">
                    <div class="mb-4">
                        <label for="theme" class="block text-gray-300 mb-1">Thème</label>
                        <select id="theme" class="input-field">
                            <option value="twilight">Twilight (Défaut)</option>
                            <option value="light">Clair</option>
                            <option value="dark">Sombre</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label for="currency" class="block text-gray-300 mb-1">Devise</label>
                        <select id="currency" class="input-field">
                            <option value="DZD">DZD (Dinar Algérien)</option>
                            <option value="EUR">EUR (Euro)</option>
                            <option value="USD">USD (Dollar)</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label for="language" class="block text-gray-300 mb-1">Langue</label>
                        <select id="language" class="input-field">
                            <option value="fr">Français</option>
                            <option value="en">Anglais</option>
                            <option value="ar">Arabe</option>
                        </select>
                    </div>
                    <button type="submit" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-md transition w-full transform hover:scale-105">
                        Enregistrer
                    </button>
                </form>
            </div>

            <!-- Camera Settings -->
            <div class="card bg-gray-800 p-6 rounded-lg glow">
                <h2 class="text-2xl font-semibold text-gray-100 mb-4">
                    <i class="fas fa-camera mr-2 text-purple-400"></i> Paramètres Caméra
                </h2>
                <div id="cameraPreview"></div>
                <form id="cameraSettingsForm">
                    <div class="mb-4">
                        <label for="cameraResolution" class="block text-gray-300 mb-1">Résolution Caméra</label>
                        <select id="cameraResolution" class="input-field">
                            <option value="low">Basse (480p)</option>
                            <option value="medium">Moyenne (720p)</option>
                            <option value="high">Haute (1080p)</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label for="cameraFacing" class="block text-gray-300 mb-1">Caméra Préférée</label>
                        <select id="cameraFacing" class="input-field">
                            <option value="environment">Arrière</option>
                            <option value="user">Avant</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="flex items-center text-gray-300">
                            <input type="checkbox" id="autoScan" class="mr-2">
                            Scan Automatique
                        </label>
                    </div>
                    <button type="button" id="testCamera" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-md transition w-full transform hover:scale-105 mb-4">
                        Tester Caméra
                    </button>
                    <button type="submit" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-md transition w-full transform hover:scale-105">
                        Enregistrer
                    </button>
                </form>
            </div>

            <!-- Notifications -->
            <div class="card bg-gray-800 p-6 rounded-lg glow">
                <h2 class="text-2xl font-semibold text-gray-100 mb-4">
                    <i class="fas fa-bell mr-2 text-purple-400"></i> Notifications
                </h2>
                <form id="notificationSettingsForm">
                    <div class="mb-4">
                        <label class="flex items-center text-gray-300">
                            <input type="checkbox" id="emailNotifications" class="mr-2">
                            Notifications par Email
                        </label>
                    </div>
                    <div class="mb-4">
                        <label class="flex items-center text-gray-300">
                            <input type="checkbox" id="appNotifications" class="mr-2">
                            Notifications In-App
                        </label>
                    </div>
                    <div class="mb-4">
                        <label for="notificationEmail" class="block text-gray-300 mb-1">Email pour Notifications</label>
                        <input type="email" id="notificationEmail" class="input-field" placeholder="exemple@firepoz.com">
                    </div>
                    <button type="submit" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-md transition w-full transform hover:scale-105">
                        Enregistrer
                    </button>
                </form>
            </div>

            <!-- Stock Settings -->
            <div class="card bg-gray-800 p-6 rounded-lg glow">
                <h2 class="text-2xl font-semibold text-gray-100 mb-4">
                    <i class="fas fa-boxes mr-2 text-purple-400"></i> Paramètres de Stock
                </h2>
                <form id="stockSettingsForm">
                    <div class="mb-4">
                        <label for="lowStockThreshold" class="block text-gray-300 mb-1">Seuil Stock Faible</label>
                        <input type="number" id="lowStockThreshold" class="input-field" placeholder="Ex: 10 unités" min="0">
                    </div>
                    <div class="mb-4">
                        <label class="flex items-center text-gray-300">
                            <input type="checkbox" id="autoReorder" class="mr-2">
                            Réapprovisionnement Automatique
                        </label>
                    </div>
                    <div class="mb-4">
                        <label for="reorderQuantity" class="block text-gray-300 mb-1">Quantité Réapprovisionnement</label>
                        <input type="number" id="reorderQuantity" class="input-field" placeholder="Ex: 50 unités" min="0">
                    </div>
                    <button type="submit" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-md transition w-full transform hover:scale-105">
                        Enregistrer
                    </button>
                </form>
            </div>

            <!-- Report Settings -->
            <div class="card bg-gray-800 p-6 rounded-lg glow">
                <h2 class="text-2xl font-semibold text-gray-100 mb-4">
                    <i class="fas fa-file-alt mr-2 text-purple-400"></i> Paramètres des Rapports
                </h2>
                <form id="reportSettingsForm">
                    <div class="mb-4">
                        <label for="reportFormat" class="block text-gray-300 mb-1">Format des Rapports</label>
                        <select id="reportFormat" class="input-field">
                            <option value="pdf">PDF</option>
                            <option value="excel">Excel</option>
                            <option value="csv">CSV</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label for="reportFrequency" class="block text-gray-300 mb-1">Fréquence des Rapports</label>
                        <select id="reportFrequency" class="input-field">
                            <option value="daily">Quotidien</option>
                            <option value="weekly">Hebdomadaire</option>
                            <option value="monthly">Mensuel</option>
                        </select>
                    </div>
                    <button type="submit" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-md transition w-full transform hover:scale-105">
                        Enregistrer
                    </button>
                </form>
            </div>

            <!-- Performance Settings -->
            <div class="card bg-gray-800 p-6 rounded-lg glow">
                <h2 class="text-2xl font-semibold text-gray-100 mb-4">
                    <i class="fas fa-tachometer-alt mr-2 text-purple-400"></i> Paramètres de Performance
                </h2>
                <form id="performanceSettingsForm">
                    <div class="mb-4">
                        <label class="flex items-center text-gray-300">
                            <input type="checkbox" id="enableCache" class="mr-2">
                            Activer le Cache Local
                        </label>
                    </div>
                    <div class="mb-4">
                        <label for="syncInterval" class="block text-gray-300 mb-1">Intervalle de Synchronisation (minutes)</label>
                        <input type="number" id="syncInterval" class="input-field" placeholder="Ex: 30" min="1">
                    </div>
                    <div class="mb-4">
                        <label class="flex items-center text-gray-300">
                            <input type="checkbox" id="offlineMode" class="mr-2">
                            Mode Hors Ligne
                        </label>
                    </div>
                    <button type="submit" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-md transition w-full transform hover:scale-105">
                        Enregistrer
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-4 right-4 hidden toast">
        <div class="flex items-center px-6 py-3 rounded-md shadow-lg">
            <i id="toastIcon" class="mr-2"></i>
            <span id="toastMessage"></span>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-900 py-6 mt-12 animate-fade-in">
        <div class="container mx-auto text-center text-gray-400">
            <p>Firepoz © 2025 - Développé par <span class="text-purple-400">Khelladi Hicham</span></p>
            <p class="mt-2">Tous droits réservés.</p>
        </div>
    </footer>

    <script>
        const API_BASE_URL = 'https://web-production-3b9e.up.railway.app';
        let stream = null;

        // Show toast notification
        function showToast(message, isError = false) {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            const toastIcon = document.getElementById('toastIcon');

            toast.className = `fixed bottom-4 right-4 flex items-center px-6 py-3 rounded-md shadow-lg toast ${
                isError ? 'bg-red-500 text-white' : 'bg-green-500 text-white'
            }`;
            toastIcon.className = `fas ${isError ? 'fa-exclamation-circle' : 'fa-check-circle'} mr-2`;
            toastMessage.textContent = message;
            toast.classList.remove('hidden');

            setTimeout(() => toast.classList.add('hidden'), 3000);
        }

        // Apply theme from localStorage
        function applyTheme() {
            const theme = localStorage.getItem('theme') || 'twilight';
            if (theme === 'light') {
                document.body.style.background = 'linear-gradient(135deg, #f3f4f6, #e5e7eb)';
                document.querySelectorAll('.card').forEach(card => card.style.background = '#ffffff');
            } else if (theme === 'dark') {
                document.body.style.background = 'linear-gradient(135deg, #111827, #1f2937)';
                document.querySelectorAll('.card').forEach(card => card.style.background = '#1f2937');
            }
            document.getElementById('theme').value = theme;
        }

        // Load settings
        async function loadSettings() {
            const userId = localStorage.getItem('userId') || 'default';
            try {
                const response = await fetch(`${API_BASE_URL}/parametres`, {
                    headers: { 'X-User-ID': userId }
                });
                if (!response.ok) {
                    throw new Error('Erreur de chargement des paramètres');
                }
                const settings = await response.json();
                document.getElementById('theme').value = settings.theme || 'twilight';
                document.getElementById('currency').value = settings.currency || 'DZD';
                document.getElementById('language').value = settings.language || 'fr';
                document.getElementById('cameraResolution').value = settings.cameraResolution || 'medium';
                document.getElementById('cameraFacing').value = settings.cameraFacing || 'environment';
                document.getElementById('autoScan').checked = settings.autoScan || false;
                document.getElementById('emailNotifications').checked = settings.emailNotifications || false;
                document.getElementById('appNotifications').checked = settings.appNotifications || false;
                document.getElementById('notificationEmail').value = settings.notificationEmail || '';
                document.getElementById('lowStockThreshold').value = settings.lowStockThreshold || 10;
                document.getElementById('autoReorder').checked = settings.autoReorder || false;
                document.getElementById('reorderQuantity').value = settings.reorderQuantity || 50;
                document.getElementById('reportFormat').value = settings.reportFormat || 'pdf';
                document.getElementById('reportFrequency').value = settings.reportFrequency || 'weekly';
                document.getElementById('enableCache').checked = settings.enableCache || false;
                document.getElementById('syncInterval').value = settings.syncInterval || 30;
                document.getElementById('offlineMode').checked = settings.offlineMode || false;
                applyTheme();
            } catch (error) {
                showToast(`Erreur de chargement des paramètres: ${error.message}`, true);
                console.error('Erreur paramètres:', error);
            }
        }

        // Save settings
        async function saveSettings(formId, settings) {
            const userId = localStorage.getItem('userId') || 'default';
            try {
                const response = await fetch(`${API_BASE_URL}/parametres`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-User-ID': userId
                    },
                    body: JSON.stringify(settings)
                });
                if (!response.ok) {
                    throw new Error('Échec de la sauvegarde');
                }
                showToast(`Paramètres ${formId.replace('SettingsForm', '').toLowerCase()} sauvegardés`);
            } catch (error) {
                showToast(`Erreur de sauvegarde: ${error.message}`, true);
                console.error('Erreur sauvegarde:', error);
            }
        }

        // Camera test
        async function testCamera() {
            if (!('BarcodeDetector' in window)) {
                showToast('Le détecteur de codes-barres n\'est pas pris en charge', true);
                return;
            }

            try {
                const resolution = document.getElementById('cameraResolution').value;
                const facingMode = document.getElementById('cameraFacing').value;
                const constraints = {
                    video: {
                        facingMode: facingMode,
                        width: { ideal: resolution === 'high' ? 1920 : resolution === 'medium' ? 1280 : 640 },
                        height: { ideal: resolution === 'high' ? 1080 : resolution === 'medium' ? 720 : 480 }
                    }
                };

                stream = await navigator.mediaDevices.getUserMedia(constraints);
                const video = document.createElement('video');
                video.srcObject = stream;
                video.setAttribute('playsinline', '');
                video.play();

                const cameraPreview = document.getElementById('cameraPreview');
                cameraPreview.innerHTML = '';
                cameraPreview.appendChild(video);
                cameraPreview.style.display = 'block';

                setTimeout(() => stopCamera(), 5000); // Stop after 5 seconds
                showToast('Caméra testée avec succès');
            } catch (error) {
                showToast(`Erreur d'accès à la caméra: ${error.message}`, true);
                console.error('Erreur caméra:', error);
            }
        }

        function stopCamera() {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }
            const cameraPreview = document.getElementById('cameraPreview');
            cameraPreview.innerHTML = '';
            cameraPreview.style.display = 'none';
        }

        // Form submissions
        document.getElementById('generalSettingsForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const settings = {
                theme: document.getElementById('theme').value,
                currency: document.getElementById('currency').value,
                language: document.getElementById('language').value
            };
            localStorage.setItem('theme', settings.theme);
            applyTheme();
            await saveSettings('generalSettingsForm', settings);
        });

        document.getElementById('cameraSettingsForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const settings = {
                cameraResolution: document.getElementById('cameraResolution').value,
                cameraFacing: document.getElementById('cameraFacing').value,
                autoScan: document.getElementById('autoScan').checked
            };
            await saveSettings('cameraSettingsForm', settings);
        });

        document.getElementById('notificationSettingsForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const settings = {
                emailNotifications: document.getElementById('emailNotifications').checked,
                appNotifications: document.getElementById('appNotifications').checked,
                notificationEmail: document.getElementById('notificationEmail').value
            };
            await saveSettings('notificationSettingsForm', settings);
        });

        document.getElementById('stockSettingsForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const settings = {
                lowStockThreshold: parseInt(document.getElementById('lowStockThreshold').value) || 10,
                autoReorder: document.getElementById('autoReorder').checked,
                reorderQuantity: parseInt(document.getElementById('reorderQuantity').value) || 50
            };
            await saveSettings('stockSettingsForm', settings);
        });

        document.getElementById('reportSettingsForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const settings = {
                reportFormat: document.getElementById('reportFormat').value,
                reportFrequency: document.getElementById('reportFrequency').value
            };
            await saveSettings('reportSettingsForm', settings);
        });

        document.getElementById('performanceSettingsForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const settings = {
                enableCache: document.getElementById('enableCache').checked,
                syncInterval: parseInt(document.getElementById('syncInterval').value) || 30,
                offlineMode: document.getElementById('offlineMode').checked
            };
            await saveSettings('performanceSettingsForm', settings);
        });

        // Camera test button
        document.getElementById('testCamera').addEventListener('click', testCamera);

        // Initialization
        document.addEventListener('DOMContentLoaded', () => {
            applyTheme();
            loadSettings();
        });
    </script>
</body>
</html>