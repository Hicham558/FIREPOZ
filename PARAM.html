<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paramètres - Firepoz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer">
    <style>
    /* Style pour les boutons d'icônes */
.icon-button {
    width: 96px; /* Taille ajustée pour correspondre à l'image */
    height: 96px; /* Égal à la largeur pour un cercle parfait */
    display: flex;
    justify-content: center;
    align-items: center;
    border-radius: 50%; /* Assure une forme parfaitement ronde */
    transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    animation: pulseButton 2s ease-in-out infinite; /* Animation pulsante */
}

.icon-button:hover {
    transform: scale(1.1) translateY(-4px); /* Zoom et soulèvement */
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
}

/* Animation pulsante pour les boutons */
@keyframes pulseButton {
    0%, 100% {
        transform: scale(1);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    50% {
        transform: scale(1.03);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
    }
}

/* Style pour les labels */
.label-animated {
    opacity: 0;
    transform: translateY(10px);
    animation: slideUpLabel 0.5s ease-out forwards;
    animation-delay: 0.3s; /* Délai pour synchroniser avec l'animation des cartes */
    text-align: center;
    max-width: 80px; /* Limite la largeur pour éviter le débordement */
}

/* Animation pour les labels */
@keyframes slideUpLabel {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Ajustement pour les écrans plus petits */
@media (max-width: 768px) {
    .icon-button {
        width: 72px;
        height: 72px;
    }
    .icon-button i {
        font-size: 2rem; /* Taille de l'icône pour petits écrans */
    }
    .label-animated {
        font-size: 0.75rem; /* Taille de texte réduite pour mobile */
        max-width: 60px;
    }
} 
   body { 
            font-family: 'Inter', sans-serif;
            transition: background-color 0.4s ease;
        }

        /* Animations améliorées */
        @keyframes slideDown {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.1);
                opacity: 0.8;
            }
        }

        @keyframes glow {
            0%, 100% {
                filter: drop-shadow(0 0 3px rgba(251, 191, 36, 0.5));
            }
            50% {
                filter: drop-shadow(0 0 8px rgba(251, 191, 36, 0.8));
            }
        }

        .nav-animated {
            animation: slideDown 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .card-animated {
            animation: fadeIn 0.5s ease-out forwards;
            opacity: 0;
        }

        .card-animated:nth-child(1) { animation-delay: 0.1s; }
        .card-animated:nth-child(2) { animation-delay: 0.2s; }
        .card-animated:nth-child(3) { animation-delay: 0.3s; }
        .card-animated:nth-child(4) { animation-delay: 0.4s; }
        .card-animated:nth-child(5) { animation-delay: 0.5s; }
        .card-animated:nth-child(6) { animation-delay: 0.6s; }
        .card-animated:nth-child(7) { animation-delay: 0.7s; }

        .kpi-card {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .kpi-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        .fire-icon {
            animation: glow 2s ease-in-out infinite;
        }

        .user-badge {
            animation: fadeIn 0.5s ease-out 0.3s forwards;
            opacity: 0;
        }

        .toast {
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .toast.show {
            transform: translateX(0) scale(1);
            opacity: 1;
        }

        .toast.hidden {
            transform: translateX(400px) scale(0.8);
            opacity: 0;
        }

        .btn-primary {
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn-primary:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary:active {
            transform: scale(0.95);
        }

        /* Thèmes */
        body.theme-light {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }

        body.theme-dark {
            background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
        }

        body.theme-twilight {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
        }

        .theme-dark .kpi-card {
            background: rgba(31, 41, 55, 0.95);
            border: 1px solid rgba(75, 85, 99, 0.3);
        }

        .theme-twilight .kpi-card {
            background: rgba(55, 65, 81, 0.85);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(139, 92, 246, 0.3);
        }

        input:focus, select:focus {
            outline: none;
            ring: 2px;
            ring-color: rgb(99, 102, 241);
            transition: all 0.3s ease;
        }

        .theme-twilight input:focus, .theme-twilight select:focus {
            ring-color: rgb(167, 139, 250);
        }
    </style>
</head>
<body class="theme-light min-h-screen">
    <!-- Barre de navigation -->
    <nav class="bg-gradient-to-r from-indigo-600 to-indigo-700 text-white p-4 fixed w-full top-0 z-10 shadow-lg nav-animated">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex flex-col">
                <h1 class="text-2xl font-bold flex items-center">
                    <i class="fas fa-fire mr-2 text-amber-400 fire-icon"></i> Firepoz Param
                </h1>
                <span id="userDisplay" class="text-xs mt-1 user-badge hidden text-indigo-100"></span>
            </div>
            <div class="space-x-4 flex items-center">
                <a href="./index.html" class="hover:text-indigo-200 transition-all duration-300 flex items-center hover:scale-110">
                    <i class="fas fa-home mr-1"></i> Accueil
                </a>
                <a href="https://github.com/Hicham558/FIREPOZ/releases/download/untagged-2711f45614d596a3f23c/_firepoz_18969177.apk" class="hover:text-indigo-200 transition-all duration-300 flex items-center hover:scale-110" download>
                    <i class="fas fa-download mr-1"></i> APK
                </a>
                <button id="logoutButton" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-all duration-300 flex items-center shadow-md hover:shadow-lg hover:scale-105">
                    <i class="fas fa-sign-out-alt mr-1"></i> Déconnexion
                </button>
            </div>
        </div>
    </nav>

    <!-- Contenu principal -->
    <main class="container mx-auto px-4 py-16 mt-16">
        
<!-- Paramètres de l'API -->
<div class="kpi-card bg-white shadow-xl rounded-2xl p-6 mb-6 card-animated">
    <h3 class="text-2xl font-semibold mb-4 text-gray-800 flex items-center">
        <i class="fas fa-server mr-2 text-indigo-600"></i> Paramètres de l'API
    </h3>
    <form id="apiSettingsForm" class="space-y-4">
        <div class="flex items-end space-x-2">
            <div class="flex-1">
                <label for="apiBaseUrl" class="block text-sm font-medium text-gray-700 mb-2">URL de l'API</label>
                <input id="apiBaseUrl" type="text" name="apiBaseUrl" class="w-full px-4 py-2 text-sm border-2 border-gray-300 bg-white text-gray-800 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-300 placeholder:text-xs animate-pulse" placeholder="ex: https://your-subdomain.loca.lt">
            </div>
            <!-- Boutons d'action alignés horizontalement -->
            <div class="flex space-x-2 mb-1">
                <button type="button" onclick="openApiUrlInBrowser()" class="bg-blue-600 text-white p-3 rounded-lg hover:bg-blue-700 transition-all duration-300 flex items-center justify-center shadow-md hover:shadow-lg btn-primary" aria-label="Ouvrir l'URL de l'API dans le navigateur">
                    <i class="fas fa-external-link-alt text-lg"></i>
                </button>
                <button type="button" onclick="scanQrCode()" class="bg-indigo-600 text-white p-3 rounded-lg hover:bg-indigo-700 transition-all duration-300 flex items-center justify-center shadow-md hover:shadow-lg btn-primary" aria-label="Scanner un QR code pour l'URL de l'API">
                    <i class="fas fa-qrcode text-lg"></i>
                </button>
            </div>
        </div>
        <div class="flex flex-row justify-center items-start gap-6 mt-6">
            <div class="flex flex-col items-center">
                <button type="button" onclick="setOfflineMode()" class="bg-gradient-to-r from-gray-600 to-gray-700 text-white p-4 w-24 h-24 rounded-full hover:from-gray-700 hover:to-gray-800 transition-all duration-300 flex items-center justify-center shadow-md hover:shadow-lg btn-primary icon-button">
                    <i class="fas fa-mobile text-4xl"></i>
                </button>
                <span class="mt-2 text-sm font-medium text-gray-700 theme-dark:text-gray-300 theme-twilight:text-gray-200 label-animated">Base Locale</span>
            </div>
            <div class="flex flex-col items-center">
                <button type="button" onclick="resetApiUrl()" class="bg-gradient-to-r from-blue-600 to-blue-700 text-white p-4 w-24 h-24 rounded-full hover:from-blue-700 hover:to-blue-800 transition-all duration-300 flex items-center justify-center shadow-md hover:shadow-lg btn-primary icon-button">
                    <i class="fas fa-cloud text-4xl"></i>
                </button>
                <span class="mt-2 text-sm font-medium text-gray-700 theme-dark:text-gray-300 theme-twilight:text-gray-200 label-animated">SupaBase Cloud</span>
            </div>
            <div class="flex flex-col items-center">
                <button type="button" onclick="resetToSecondaryApiUrl()" class="bg-gradient-to-r from-purple-600 to-purple-700 text-white p-4 w-24 h-24 rounded-full hover:from-purple-700 hover:to-purple-800 transition-all duration-300 flex items-center justify-center shadow-md hover:shadow-lg btn-primary icon-button">
                    <i class="fas fa-server text-4xl"></i>
                </button>
                <span class="mt-2 text-sm font-medium text-gray-700 theme-dark:text-gray-300 theme-twilight:text-gray-200 label-animated">Serveur PC</span>
            </div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <button type="button" onclick="testDbConnection()" class="bg-gradient-to-r from-green-600 to-green-700 text-white py-3 px-4 rounded-lg hover:from-green-700 hover:to-green-800 transition-all duration-300 flex items-center justify-center shadow-md hover:shadow-lg btn-primary">
                <i class="fas fa-plug mr-2"></i> Tester Connexion
            </button>
            <button type="button" onclick="window.location.href='./BDD.html'" class="bg-gradient-to-r from-indigo-600 to-indigo-700 text-white py-3 px-4 rounded-lg hover:from-indigo-700 hover:to-indigo-800 transition-all duration-300 flex items-center justify-center shadow-md hover:shadow-lg btn-primary">
                <i class="fas fa-database mr-2"></i> Gestion BDD Hors Ligne
            </button>
        </div>
    </form>
</div>

        <!-- Paramètres Généraux -->
        <div class="kpi-card bg-white shadow-xl rounded-2xl p-6 mb-6 card-animated">
            <h3 class="text-2xl font-semibold mb-4 text-gray-800 flex items-center">
                <i class="fas fa-cog mr-2 text-indigo-600"></i> Paramètres Généraux
            </h3>
            <form id="generalSettingsForm" class="space-y-4">
                <div>
                    <label for="companyName" class="block text-sm font-medium text-gray-700 mb-2">Nom de l'Entreprise</label>
                    <input id="companyName" type="text" name="companyName" class="w-full px-4 py-3 border-2 border-gray-300 bg-white text-gray-800 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-300" placeholder="Nom de l'entreprise">
                </div>
                <div>
                    <label for="companyAddress" class="block text-sm font-medium text-gray-700 mb-2">Adresse</label>
                    <input id="companyAddress" type="text" name="companyAddress" class="w-full px-4 py-3 border-2 border-gray-300 bg-white text-gray-800 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-300" placeholder="Adresse de l'entreprise">
                </div>
                <div>
                    <label for="companyPhone" class="block text-sm font-medium text-gray-700 mb-2">Téléphone</label>
                    <input id="companyPhone" type="tel" name="companyPhone" class="w-full px-4 py-3 border-2 border-gray-300 bg-white text-gray-800 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-300" placeholder="+213...">
                </div>
                <div>
                    <label for="companyLogo" class="block text-sm font-medium text-gray-700 mb-2">Logo de l'Entreprise</label>
                    <input id="companyLogo" type="file" accept="image/*" name="companyLogo" class="w-full px-4 py-3 border-2 border-gray-300 bg-white text-gray-800 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-300">
                    <img id="logoPreview" class="mt-3 max-w-[150px] rounded-lg shadow-md hidden" alt="Prévisualisation du logo">
                </div>
                <div>
                    <label for="theme" class="block text-sm font-medium text-gray-700 mb-2">Thème</label>
                    <select id="theme" name="theme" class="w-full px-4 py-3 border-2 border-gray-300 bg-white text-gray-800 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-300">
                        <option value="light">Clair</option>
                        <option value="dark">Sombre</option>
                        <option value="twilight">Twilight</option>
                    </select>
                </div>
                <div>
                    <label for="currency" class="block text-sm font-medium text-gray-700 mb-2">Devise</label>
                    <select id="currency" name="currency" class="w-full px-4 py-3 border-2 border-gray-300 bg-white text-gray-800 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-300">
                        <option value="DZD">DZD</option>
                        <option value="USD">USD</option>
                        <option value="EUR">EUR</option>
                    </select>
                </div>
                <div>
                    <label for="language" class="block text-sm font-medium text-gray-700 mb-2">Langue</label>
                    <select id="language" name="language" class="w-full px-4 py-3 border-2 border-gray-300 bg-white text-gray-800 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-300">
                        <option value="fr">Français</option>
                        <option value="en">English</option>
                        <option value="ar">العربية</option>
                    </select>
                </div>
            </form>
        </div>

        <!-- Paramètres Caméra -->
        <div class="kpi-card bg-white shadow-xl rounded-2xl p-6 mb-6 card-animated">
            <h3 class="text-2xl font-semibold mb-4 text-gray-800 flex items-center">
                <i class="fas fa-camera mr-2 text-indigo-600"></i> Paramètres Caméra
            </h3>
            <form id="cameraSettingsForm" class="space-y-4">
                <div>
                    <label for="cameraResolution" class="block text-sm font-medium text-gray-700 mb-2">Résolution Caméra</label>
                    <select id="cameraResolution" name="cameraResolution" class="w-full px-4 py-3 border-2 border-gray-300 bg-white text-gray-800 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-300">
                        <option value="low">Basse (480p)</option>
                        <option value="medium">Moyenne (720p)</option>
                        <option value="high">Haute (1080p)</option>
                    </select>
                </div>
                <div>
                    <label for="cameraFacing" class="block text-sm font-medium text-gray-700 mb-2">Orientation Caméra</label>
                    <select id="cameraFacing" name="cameraFacing" class="w-full px-4 py-3 border-2 border-gray-300 bg-white text-gray-800 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-300">
                        <option value="environment">Arrière</option>
                        <option value="user">Avant</option>
                    </select>
                </div>
                <div class="flex items-center">
                    <input id="autoScan" type="checkbox" class="w-5 h-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500 transition-all duration-300">
                    <label for="autoScan" class="ml-3 text-sm font-medium text-gray-700">Scan Automatique</label>
                </div>
                <button type="button" id="testCamera" class="w-full bg-gradient-to-r from-indigo-600 to-indigo-700 text-white py-3 px-4 rounded-lg hover:from-indigo-700 hover:to-indigo-800 transition-all duration-300 shadow-md hover:shadow-lg btn-primary">
                    <i class="fas fa-video mr-2"></i> Tester Caméra
                </button>
            </form>
            <div id="cameraPreview" class="hidden mt-4 w-full max-w-[300px] h-[200px] border-2 border-gray-300 bg-black rounded-lg overflow-hidden shadow-md"></div>
        </div>

        <!-- Notifications -->
        <div class="kpi-card bg-white shadow-xl rounded-2xl p-6 mb-6 card-animated">
            <h3 class="text-2xl font-semibold mb-4 text-gray-800 flex items-center">
                <i class="fas fa-bell mr-2 text-indigo-600"></i> Notifications
            </h3>
            <form id="notificationSettingsForm" class="space-y-4">
                <div class="flex items-center">
                    <input id="emailNotifications" type="checkbox" class="w-5 h-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500 transition-all duration-300">
                    <label for="emailNotifications" class="ml-3 text-sm font-medium text-gray-700">Notifications par Email</label>
                </div>
                <div class="flex items-center">
                    <input id="appNotifications" type="checkbox" class="w-5 h-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500 transition-all duration-300">
                    <label for="appNotifications" class="ml-3 text-sm font-medium text-gray-700">Notifications In-App</label>
                </div>
                <div>
                    <label for="notificationEmail" class="block text-sm font-medium text-gray-700 mb-2">Email pour Notifications</label>
                    <input id="notificationEmail" type="email" name="notificationEmail" class="w-full px-4 py-3 border-2 border-gray-300 bg-white text-gray-800 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-300" placeholder="exemple@domaine.com">
                </div>
            </form>
        </div>

        <!-- Gestion du Stock -->
        <div class="kpi-card bg-white shadow-xl rounded-2xl p-6 mb-6 card-animated">
            <h3 class="text-2xl font-semibold mb-4 text-gray-800 flex items-center">
                <i class="fas fa-boxes mr-2 text-indigo-600"></i> Gestion du Stock
            </h3>
            <form id="stockSettingsForm" class="space-y-4">
                <div>
                    <label for="lowStockThreshold" class="block text-sm font-medium text-gray-700 mb-2">Seuil de Stock Faible</label>
                    <input id="lowStockThreshold" type="number" name="lowStockThreshold" min="0" class="w-full px-4 py-3 border-2 border-gray-300 bg-white text-gray-800 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-300" placeholder="10">
                </div>
                <div class="flex items-center">
                    <input id="autoReorder" type="checkbox" class="w-5 h-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500 transition-all duration-300">
                    <label for="autoReorder" class="ml-3 text-sm font-medium text-gray-700">Réapprovisionnement Automatique</label>
                </div>
                <div>
                    <label for="reorderQuantity" class="block text-sm font-medium text-gray-700 mb-2">Quantité de Réapprovisionnement</label>
                    <input id="reorderQuantity" type="number" name="reorderQuantity" min="0" class="w-full px-4 py-3 border-2 border-gray-300 bg-white text-gray-800 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-300" placeholder="50">
                </div>
            </form>
        </div>

        <!-- Rapports -->
        <div class="kpi-card bg-white shadow-xl rounded-2xl p-6 mb-6 card-animated">
            <h3 class="text-2xl font-semibold mb-4 text-gray-800 flex items-center">
                <i class="fas fa-chart-line mr-2 text-indigo-600"></i> Rapports
            </h3>
            <form id="reportSettingsForm" class="space-y-4">
                <div>
                    <label for="reportFormat" class="block text-sm font-medium text-gray-700 mb-2">Format des Rapports</label>
                    <select id="reportFormat" name="reportFormat" class="w-full px-4 py-3 border-2 border-gray-300 bg-white text-gray-800 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-300">
                        <option value="pdf">PDF</option>
                        <option value="excel">Excel</option>
                        <option value="csv">CSV</option>
                    </select>
                </div>
                <div>
                    <label for="reportFrequency" class="block text-sm font-medium text-gray-700 mb-2">Fréquence des Rapports</label>
                    <select id="reportFrequency" name="reportFrequency" class="w-full px-4 py-3 border-2 border-gray-300 bg-white text-gray-800 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-300">
                        <option value="daily">Quotidien</option>
                        <option value="weekly">Hebdomadaire</option>
                        <option value="monthly">Mensuel</option>
                    </select>
                </div>
            </form>
        </div>

        <!-- Performance -->
        <div class="kpi-card bg-white shadow-xl rounded-2xl p-6 mb-6 card-animated">
            <h3 class="text-2xl font-semibold mb-4 text-gray-800 flex items-center">
                <i class="fas fa-tachometer-alt mr-2 text-indigo-600"></i> Performance
            </h3>
            <form id="performanceSettingsForm" class="space-y-4">
                <div class="flex items-center">
                    <input id="enableCache" type="checkbox" class="w-5 h-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500 transition-all duration-300">
                    <label for="enableCache" class="ml-3 text-sm font-medium text-gray-700">Activer le Cache</label>
                </div>
                <div>
                    <label for="syncInterval" class="block text-sm font-medium text-gray-700 mb-2">Intervalle de Synchronisation (minutes)</label>
                    <input id="syncInterval" type="number" name="syncInterval" min="1" class="w-full px-4 py-3 border-2 border-gray-300 bg-white text-gray-800 rounded-lg shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-300" placeholder="30">
                </div>
                <div class="flex items-center">
                    <input id="offlineMode" type="checkbox" class="w-5 h-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500 transition-all duration-300">
                    <label for="offlineMode" class="ml-3 text-sm font-medium text-gray-700">Mode Hors-Ligne</label>
                </div>
            </form>
        </div>
    </main>

    <!-- Toast notification -->
    <div id="toast" class="fixed bottom-4 right-4 hidden toast">
        <div class="flex items-center px-6 py-4 rounded-lg shadow-2xl">
            <i id="toastIcon" class="mr-3 text-xl"></i>
            <span id="toastMessage" class="font-medium"></span>
        </div>
    </div>

    <script>
        let stream = null;
        const DEFAULT_API_URL = 'https://hicham03041979.onrender.com';
        let API_BASE_URL = localStorage.getItem('apiBaseUrl') || DEFAULT_API_URL;

        function showToast(message, isError = false) {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            const toastIcon = document.getElementById('toastIcon');

            if (!toast || !toastMessage || !toastIcon) {
                console.error('Éléments toast non trouvés');
                return;
            }

            const container = toast.querySelector('div');
            container.className = `flex items-center px-6 py-4 rounded-lg shadow-2xl ${
                isError ? 'bg-red-500 text-white' : 'bg-green-500 text-white'
            }`;
            toastIcon.className = `fas ${isError ? 'fa-exclamation-circle' : 'fa-check-circle'} mr-3 text-xl`;
            toastMessage.textContent = message;
            
            toast.classList.remove('hidden');
            setTimeout(() => toast.classList.add('show'), 10);

            setTimeout(() => {
                toast.classList.remove('show');
                toast.classList.add('hidden');
            }, 3000);
        }
// Ouvrir l'URL de l'API dans le navigateur
function openApiUrlInBrowser() {
    if (!checkLoginStatus()) {
        console.log('Navigation annulée: utilisateur non connecté');
        return;
    }
    
    const apiBaseUrlInput = document.getElementById('apiBaseUrl');
    const apiUrl = apiBaseUrlInput.value.trim();
    
    if (!apiUrl) {
        showToast('Veuillez saisir une URL valide', true);
        return;
    }
    
    try {
        // Vérifier que l'URL est valide
        const url = new URL(apiUrl);
        
        // Ouvrir dans un nouvel onglet
        window.open(url.toString(), '_blank', 'noopener,noreferrer');
        
        showToast(`Ouverture de ${apiUrl} dans le navigateur`);
        console.log('URL ouverte dans le navigateur:', apiUrl);
        
    } catch (error) {
        showToast('URL invalide. Format attendu: https://exemple.com', true);
        console.error('URL invalide:', apiUrl, error);
    }
}
         function setOfflineMode() {
            if (!checkLoginStatus()) {
                console.log('Mode hors ligne annulé: utilisateur non connecté');
                return;
            }
            const apiBaseUrlInput = document.getElementById('apiBaseUrl');
            apiBaseUrlInput.value = '/api';
            localStorage.setItem('apiBaseUrl', '/api'); 
            showToast('Mode hors ligne activé: URL définie sur /api');
            console.log('Mode hors ligne activé: URL définie sur /api');
            updateApiButtonsIndicator();
  }

        // Scanner un QR code pour l'URL de l'API
        async function scanQrCode() {
            if (!checkLoginStatus()) {
                console.log('Scan annulé: utilisateur non connecté');
                return;
            }
            if (!('BarcodeDetector' in window)) {
                showToast('Le scan de QR code n\'est pas pris en charge par ce navigateur', true);
                return;
            }
            try {
                const resolution = document.getElementById('cameraResolution').value;
                const facingMode = document.getElementById('cameraFacing').value;
                const constraints = {
                    video: {
                        facingMode: facingMode,
                        width: { ideal: resolution === 'high' ? 1920 : resolution === 'medium' ? 1280 : 640 },
                        height: { ideal: resolution === 'high' ? 1080 : resolution === 'medium' ? 720 : 480 }
                    }
                };
                stream = await navigator.mediaDevices.getUserMedia(constraints);
                const video = document.createElement('video');
                video.srcObject = stream;
                video.setAttribute('playsinline', '');
                video.play();

                const cameraPreview = document.getElementById('cameraPreview');
                cameraPreview.innerHTML = '';
                cameraPreview.appendChild(video);
                cameraPreview.style.display = 'block';

                const barcodeDetector = new BarcodeDetector({ formats: ['qr_code'] });
                const detectQrCode = async () => {
                    const barcodes = await barcodeDetector.detect(video);
                    if (barcodes.length > 0) {
                        const qrCodeValue = barcodes[0].rawValue;
                        const apiBaseUrlInput = document.getElementById('apiBaseUrl');
                        apiBaseUrlInput.value = qrCodeValue;
                        saveApiSettings();
                        showToast(`QR code scanné: ${qrCodeValue}`);
                        stopCamera();
                        clearInterval(interval);
                    }
                };
                const interval = setInterval(detectQrCode, 1000);
                setTimeout(() => {
                    if (stream) {
                        stopCamera();
                        clearInterval(interval);
                        showToast('Aucun QR code détecté après 10 secondes', true);
                    }
                }, 10000);
            } catch (error) {
                showToast(`Erreur lors du scan: ${error.message}`, true);
                console.error('Erreur scan QR:', error);
                stopCamera();
            }
        }

        // Appliquer le thème depuis localStorage
        function applyTheme(themeValue) {
            const theme = themeValue || localStorage.getItem('theme') || 'light';
            console.log('Application du thème:', theme);
            if (theme === 'dark') {
                document.body.classList.remove('bg-gray-100');
                document.body.classList.add('bg-gray-800');
                document.querySelectorAll('.kpi-card').forEach(card => {
                    card.classList.remove('bg-white');
                    card.classList.add('bg-gray-900');
                    card.querySelectorAll('label').forEach(label => {
                        label.classList.remove('text-gray-700');
                        label.classList.add('text-gray-200');
                    });
                    card.querySelectorAll('select, input').forEach(input => {
                        input.classList.remove('bg-white', 'text-gray-800', 'border-gray-300');
                        input.classList.add('bg-gray-800', 'text-gray-200', 'border-gray-700');
                    });
                });
            } else if (theme === 'twilight') {
                document.body.classList.remove('bg-gray-100');
                document.body.classList.add('bg-gradient-to-br', 'from-gray-800', 'to-gray-900');
                document.querySelectorAll('.kpi-card').forEach(card => {
                    card.classList.remove('bg-white');
                    card.classList.add('bg-gray-800');
                    card.querySelectorAll('label').forEach(label => {
                        label.classList.remove('text-gray-700');
                        label.classList.add('text-gray-300');
                    });
                    card.querySelectorAll('select, input').forEach(input => {
                        input.classList.remove('bg-white', 'text-gray-800', 'border-gray-300');
                        input.classList.add('bg-gray-700', 'text-gray-200', 'border-gray-600');
                    });
                });
            } else {
                document.body.classList.add('bg-gray-100');
                document.querySelectorAll('.kpi-card').forEach(card => {
                    card.classList.add('bg-white');
                    card.querySelectorAll('label').forEach(label => {
                        label.classList.add('text-gray-700');
                    });
                    card.querySelectorAll('select, input').forEach(input => {
                        input.classList.add('bg-white', 'text-gray-800', 'border-gray-300');
                    });
                });
            }
            const themeElement = document.getElementById('theme');
            if (themeElement) themeElement.value = theme;
        }

        // Vérifier l'état de connexion
        function checkLoginStatus() {
            const userId = localStorage.getItem('userId');
            const userEmail = localStorage.getItem('userEmail');
            if (!userId || !userEmail) {
                console.log('userId ou userEmail manquant, redirection vers index.html');
                showToast('Veuillez vous connecter', true);
                setTimeout(() => window.location.href = './index.html', 2000);
                return false;
            }
            const userDisplay = document.getElementById('userDisplay');
            if (userDisplay) {
                userDisplay.textContent = userEmail.toLowerCase();
                userDisplay.classList.remove('hidden');
            }
            console.log('Connexion OK:', { userId, userEmail });
            return true;
        }

        // Sauvegarder les paramètres de l'API
        function saveApiSettings() {
            if (!checkLoginStatus()) {
                console.log('Sauvegarde annulée: utilisateur non connecté');
                return;
            }
            const apiBaseUrl = document.getElementById('apiBaseUrl').value.trim();
            const urlToSave = apiBaseUrl || DEFAULT_API_URL;
            localStorage.setItem('apiBaseUrl', urlToSave);
            localStorage.setItem('secondaryApiUrl', urlToSave); // Enregistrer dans secondaryApiUrl
            API_BASE_URL = urlToSave;
            showToast(`URL de l'API sauvegardée: ${urlToSave}`);
            console.log('API_BASE_URL et secondaryApiUrl sauvegardées:', urlToSave);
        }

        // Réinitialiser l'URL de l'API à la valeur par défaut
        function resetApiUrl() {
            if (!checkLoginStatus()) {
                console.log('Réinitialisation annulée: utilisateur non connecté');
                return;
            }
            const apiBaseUrlInput = document.getElementById('apiBaseUrl');
            apiBaseUrlInput.value = DEFAULT_API_URL;
            localStorage.setItem('apiBaseUrl', DEFAULT_API_URL);
            API_BASE_URL = DEFAULT_API_URL;
            showToast(`URL de l'API réinitialisée à: ${DEFAULT_API_URL}`);
            console.log('API_BASE_URL réinitialisée:', DEFAULT_API_URL);
            updateApiButtonsIndicator();
  }

        // Revenir à l'URL de la base locale
        function resetToSecondaryApiUrl() {
            if (!checkLoginStatus()) {
                console.log('Réinitialisation à la base locale annulée: utilisateur non connecté');
                return;
            }
            const secondaryApiUrl = localStorage.getItem('secondaryApiUrl');
            if (!secondaryApiUrl) {
                showToast('Aucune URL de base locale trouvée', true);
                console.log('Aucune secondaryApiUrl trouvée dans localStorage');
                return;
            }
            const apiBaseUrlInput = document.getElementById('apiBaseUrl');
            apiBaseUrlInput.value = secondaryApiUrl;
            localStorage.setItem('apiBaseUrl', secondaryApiUrl);
            API_BASE_URL = secondaryApiUrl;
            showToast(`URL de l'API rétablie à la base locale: ${secondaryApiUrl}`);
            console.log('API_BASE_URL rétablie à secondaryApiUrl:', secondaryApiUrl);
            updateApiButtonsIndicator();
    }

        // Collecter tous les paramètres
        function collectAllSettings() {
            const settings = {
                companyName: (document.getElementById('companyName')?.value || ''),
                companyAddress: (document.getElementById('companyAddress')?.value || ''),
                companyPhone: (document.getElementById('companyPhone')?.value || ''),
                companyLogo: (document.getElementById('logoPreview')?.src || ''),
                theme: (document.getElementById('theme')?.value || 'light'),
                currency: (document.getElementById('currency')?.value || 'DZD'),
                language: (document.getElementById('language')?.value || 'fr'),
                cameraResolution: (document.getElementById('cameraResolution')?.value || 'medium'),
                cameraFacing: (document.getElementById('cameraFacing')?.value || 'environment'),
                autoScan: document.getElementById('autoScan')?.checked || false,
                emailNotifications: document.getElementById('emailNotifications')?.checked || false,
                appNotifications: document.getElementById('appNotifications')?.checked || false,
                notificationEmail: (document.getElementById('notificationEmail')?.value || ''),
                lowStockThreshold: parseInt(document.getElementById('lowStockThreshold')?.value) || 10,
                autoReorder: document.getElementById('autoReorder')?.checked || false,
                reorderQuantity: parseInt(document.getElementById('reorderQuantity')?.value) || 50,
                reportFormat: (document.getElementById('reportFormat')?.value || 'pdf'),
                reportFrequency: (document.getElementById('reportFrequency')?.value || 'weekly'),
                enableCache: document.getElementById('enableCache')?.checked || false,
                syncInterval: parseInt(document.getElementById('syncInterval')?.value) || 30,
                offlineMode: document.getElementById('offlineMode')?.checked || false,
                apiBaseUrl: (document.getElementById('apiBaseUrl')?.value || DEFAULT_API_URL)
            };
            console.log('Paramètres collectés:', settings);
            return settings;
        }
        // Mettre à jour l'indicateur visuel des boutons API
function updateApiButtonsIndicator() {
    const currentUrl = localStorage.getItem('apiBaseUrl') || DEFAULT_API_URL;
    
    // Sélectionner les 3 boutons
    const localBtn = document.querySelector('button[onclick="setOfflineMode()"]');
    const cloudBtn = document.querySelector('button[onclick="resetApiUrl()"]');
    const pcBtn = document.querySelector('button[onclick="resetToSecondaryApiUrl()"]');
    
    // Réinitialiser tous les boutons
    [localBtn, cloudBtn, pcBtn].forEach(btn => {
        if (btn) {
            btn.style.opacity = '0.5';
            btn.classList.remove('ring-4', 'ring-gray-400', 'ring-blue-400', 'ring-purple-400', 'ring-offset-2');
        }
    });
    
    // Activer le bouton correspondant
    if (currentUrl === '/api') {
        // Bouton 1: Base Locale
        if (localBtn) {
            localBtn.style.opacity = '1';
            localBtn.classList.add('ring-4', 'ring-gray-400', 'ring-offset-2');
        }
    } else if (currentUrl.includes('hicham03041979')) {
        // Bouton 2: SupaBase Cloud
        if (cloudBtn) {
            cloudBtn.style.opacity = '1';
            cloudBtn.classList.add('ring-4', 'ring-blue-400', 'ring-offset-2');
        }
    } else if (currentUrl.endsWith(':5000')) {
        // Bouton 3: Serveur PC
        if (pcBtn) {
            pcBtn.style.opacity = '1';
            pcBtn.classList.add('ring-4', 'ring-purple-400', 'ring-offset-2');
        }
    }
}
        // Charger les paramètres depuis localStorage
        function loadSettings() {
            if (!checkLoginStatus()) return;
            console.log('Chargement des paramètres');

            // Charger les paramètres depuis localStorage
            const settings = JSON.parse(localStorage.getItem('settings')) || {};

            // Ajouter la configuration de l'API
            settings.apiBaseUrl = localStorage.getItem('apiBaseUrl') || DEFAULT_API_URL;

            const fields = [
                { id: 'companyName', default: '' },
                { id: 'companyAddress', default: '' },
                { id: 'companyPhone', default: '' },
                { id: 'theme', default: 'light' },
                { id: 'currency', default: 'DZD' },
                { id: 'language', default: 'fr' },
                { id: 'cameraResolution', default: 'medium' },
                { id: 'cameraFacing', default: 'environment' },
                { id: 'autoScan', default: false, type: 'checked' },
                { id: 'emailNotifications', default: false, type: 'checked' },
                { id: 'appNotifications', default: false, type: 'checked' },
                { id: 'notificationEmail', default: '' },
                { id: 'lowStockThreshold', default: 10 },
                { id: 'autoReorder', default: false, type: 'checked' },
                { id: 'reorderQuantity', default: 50 },
                { id: 'reportFormat', default: 'pdf' },
                { id: 'reportFrequency', default: 'weekly' },
                { id: 'enableCache', default: false, type: 'checked' },
                { id: 'syncInterval', default: 30 },
                { id: 'offlineMode', default: false, type: 'checked' },
                { id: 'apiBaseUrl', default: DEFAULT_API_URL }
            ];

            fields.forEach(({ id, default: defaultValue, type }) => {
                const element = document.getElementById(id);
                if (element) {
                    if (type === 'checked') {
                        element.checked = settings[id] !== undefined ? settings[id] : defaultValue;
                    } else {
                        element.value = settings[id] !== undefined ? settings[id] : defaultValue;
                    }
                } else {
                    console.warn(`Élément ${id} non trouvé lors du chargement`);
                }
            });

            // Afficher le logo si disponible
            if (settings.companyLogo) {
                const logoPreview = document.getElementById('logoPreview');
                if (logoPreview) {
                    logoPreview.src = settings.companyLogo;
                    logoPreview.classList.remove('hidden');
                }
            }

            applyTheme(settings.theme);
            updateApiButtonsIndicator();
        }

        // Enregistrer les paramètres dans localStorage
        function saveSettings(formId) {
            if (!checkLoginStatus()) {
                console.log('Sauvegarde annulée: utilisateur non connecté');
                return;
            }
            const settings = collectAllSettings();
            console.log(`Sauvegarde des paramètres pour ${formId}:`, settings);
            localStorage.setItem('settings', JSON.stringify(settings));
            if (formId === 'apiSettingsForm') {
                localStorage.setItem('apiBaseUrl', settings.apiBaseUrl);
                localStorage.setItem('secondaryApiUrl', settings.apiBaseUrl); // Enregistrer dans secondaryApiUrl
            }
            showToast(`Paramètres ${formId.replace('SettingsForm', '').toLowerCase()} sauvegardés`);
        }

        // Gérer le téléchargement du logo
        function handleLogoUpload(event) {
            const file = event.target.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = () => {
                    const logoPreview = document.getElementById('logoPreview');
                    logoPreview.src = reader.result;
                    logoPreview.classList.remove('hidden');
                    saveSettings('generalSettingsForm');
                };
                reader.readAsDataURL(file);
                } else {
                showToast('Veuillez sélectionner une image valide', true);
            }
        }

        // Tester la caméra
        async function testCamera() {
            if (!('BarcodeDetector' in window)) {
                showToast('Le détecteur de codes-barres n\'est pas pris en charge', true);
                return;
            }
            try {
                const resolution = document.getElementById('cameraResolution').value;
                const facingMode = document.getElementById('cameraFacing').value;
                const constraints = {
                    video: {
                        facingMode: facingMode,
                        width: { ideal: resolution === 'high' ? 1920 : resolution === 'medium' ? 1280 : 640 },
                        height: { ideal: resolution === 'high' ? 1080 : resolution === 'medium' ? 720 : 480 }
                    }
                };
                stream = await navigator.mediaDevices.getUserMedia(constraints);
                const video = document.createElement('video');
                video.srcObject = stream;
                video.setAttribute('playsinline', '');
                video.play();
                const cameraPreview = document.getElementById('cameraPreview');
                cameraPreview.innerHTML = '';
                cameraPreview.appendChild(video);
                cameraPreview.style.display = 'block';
                setTimeout(() => stopCamera(), 5000);
                showToast('Caméra testée avec succès');
            } catch (error) {
                showToast(`Erreur d'accès à la caméra: ${error.message}`, true);
                console.error('Erreur caméra:', error);
            }
        }

        // Arrêter la caméra
        function stopCamera() {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }
            const cameraPreview = document.getElementById('cameraPreview');
            cameraPreview.innerHTML = '';
            cameraPreview.style.display = 'none';
        }

        // Déconnexion
        function logout() {
            localStorage.removeItem('userId');
            localStorage.removeItem('userEmail');
            showToast('Déconnexion réussie');
            setTimeout(() => window.location.href = './index.html', 1000);
        }

        // Tester la connexion à la base de données
        async function testDbConnection() {
            if (!checkLoginStatus()) return;
            try {
                const response = await fetchWithHeaders(`${API_BASE_URL}/`, {
                    method: 'GET'
                });
                if (response.ok) {
                    const text = await response.text();
                    showToast(text || 'Connexion à la base de données réussie');
                } else {
                    const data = await response.json();
                    showToast(data.erreur || 'Erreur lors du test de connexion', true);
                }
            } catch (error) {
                showToast(`Erreur: ${error.message}`, true);
                console.error('Erreur lors du test de connexion:', error);
            }
        }

        // Fonction fetch avec en-têtes personnalisés
        async function fetchWithHeaders(url, options = {}) {
            const userId = localStorage.getItem('userId');
            const headers = {
                ...options.headers,
                'X-User-ID': userId || ''
            };
            return fetch(url, { ...options, headers });
        }

        // Gestion des changements automatiques
        function setupAutoSave() {
            const settingsFields = [
                { id: 'companyName', form: 'generalSettingsForm', type: 'input' },
                { id: 'companyAddress', form: 'generalSettingsForm', type: 'input' },
                { id: 'companyPhone', form: 'generalSettingsForm', type: 'input' },
                { id: 'companyLogo', form: 'generalSettingsForm', type: 'change' },
                { id: 'theme', form: 'generalSettingsForm', type: 'change' },
                { id: 'currency', form: 'generalSettingsForm', type: 'change' },
                { id: 'language', form: 'generalSettingsForm', type: 'change' },
                { id: 'cameraResolution', form: 'cameraSettingsForm', type: 'change' },
                { id: 'cameraFacing', form: 'cameraSettingsForm', type: 'change' },
                { id: 'autoScan', form: 'cameraSettingsForm', type: 'change' },
                { id: 'emailNotifications', form: 'notificationSettingsForm', type: 'change' },
                { id: 'appNotifications', form: 'notificationSettingsForm', type: 'change' },
                { id: 'notificationEmail', form: 'notificationSettingsForm', type: 'input' },
                { id: 'lowStockThreshold', form: 'stockSettingsForm', type: 'input' },
                { id: 'autoReorder', form: 'stockSettingsForm', type: 'change' },
                { id: 'reorderQuantity', form: 'stockSettingsForm', type: 'input' },
                { id: 'reportFormat', form: 'reportSettingsForm', type: 'change' },
                { id: 'reportFrequency', form: 'reportSettingsForm', type: 'change' },
                { id: 'enableCache', form: 'performanceSettingsForm', type: 'change' },
                { id: 'syncInterval', form: 'performanceSettingsForm', type: 'input' },
                { id: 'offlineMode', form: 'performanceSettingsForm', type: 'change' },
                { id: 'apiBaseUrl', form: 'apiSettingsForm', type: 'input' }
            ];

            settingsFields.forEach(({ id, form, type }) => {
                const element = document.getElementById(id);
                if (!element) {
                    console.warn(`Élément ${id} non trouvé`);
                    return;
                }
                element.addEventListener(type, () => {
                    console.log(`Changement détecté pour ${id} (form: ${form})`);
                    if (id === 'theme') {
                        localStorage.setItem('theme', element.value);
                        applyTheme(element.value);
                    }
                    if (id === 'apiBaseUrl') {
        updateApiButtonsIndicator(); // ← AJOUTEZ CETTE LIGNE
    }
                    saveSettings(form);
                });
            });
            console.log('Écouteurs auto-save configurés pour', settingsFields.length, 'champs');

            // Écouteur spécifique pour le logo
            const logoInput = document.getElementById('companyLogo');
            if (logoInput) logoInput.addEventListener('change', handleLogoUpload);
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Initialisation de la page');
            applyTheme();
            loadSettings();
            setupAutoSave();
            const testCameraButton = document.getElementById('testCamera');
            const logoutButton = document.getElementById('logoutButton');
            if (testCameraButton) testCameraButton.addEventListener('click', testCamera);
            if (logoutButton) logoutButton.addEventListener('click', logout);
        });

    </script>
</body>
</html>
