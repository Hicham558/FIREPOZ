```html
<!-- Liste des Produits pour Vente -->
<div class="bg-white rounded-lg shadow-md transition-all duration-300 overflow-hidden animate-fade-in mb-8" id="productsSection">
    <div class="p-6 flex justify-between items-center cursor-pointer" onclick="toggleSection('productsSection')">
        <h2 class="text-xl font-semibold text-gray-800 flex items-center">
            <i class="fas fa-boxes mr-2 text-indigo-500"></i> Produits Disponibles
            <span id="productCount" class="ml-2 text-sm bg-indigo-100 text-indigo-800 px-2 py-1 rounded-full count-anim hidden">0</span>
        </h2>
        <button class="text-gray-600 hover:text-gray-800 transition">
            <i class="fas fa-chevron-down" id="productsChevron"></i>
        </button>
    </div>
    <div class="p-6 hidden" id="productsContent">
        <div class="mb-4 flex flex-col md:flex-row gap-4">
            <div class="relative w-full md:w-1/2">
                <input type="text" id="searchProduct" placeholder="Rechercher un produit..." class="w-full pl-10 pr-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
            </div>
            <div class="relative w-full md:w-1/2">
                <input type="text" id="productBar" class="w-full px-3 py-2 border rounded-md" placeholder="Scanner ou entrer code-barres" required>
                <button id="scanButton" class="absolute right-2 top-1/2 transform -translate-y-1/2 bg-indigo-600 text-white px-2 py-1 rounded-md hover:bg-indigo-700 transition duration-300" onclick="startScanner()">
                    <i class="fas fa-camera"></i> Scanner
                </button>
            </div>
        </div>

        <div class="overflow-x-auto mt-4">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Code</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Désignation</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Prix Vente</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Prix Achat</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Stock</th>
                    </tr>
                </thead>
                <tbody id="productsList" class="bg-white divide-y divide-gray-200">
                    <tr>
                        <td colspan="7" class="text-center py-4 text-gray-500">Chargement en cours...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
```

```javascript
// Charger les produits
async function chargerProduits() {
    console.log('Chargement des produits...');
    const userId = localStorage.getItem('userId');
    if (!userId) {
        showToast('Veuillez vous connecter pour voir les produits', true);
        console.error('Erreur: Aucun userId trouvé dans localStorage');
        return;
    }

    try {
        const response = await fetch(`${API_BASE_URL}/liste_produits`, {
            headers: { 'X-User-ID': userId }
        });
        console.log('Réponse liste_produits:', response.status, response.statusText);
        if (!response.ok) {
            const errorText = await response.text();
            console.error('Erreur texte liste_produits:', errorText);
            throw new Error(`Erreur ${response.status}: ${errorText}`);
        }
        produitsCache = await response.json();
        console.log('Produits reçus:', produitsCache);
        const tbody = document.getElementById('productsList');
        const countElement = document.getElementById('productCount');

        if (!produitsCache || produitsCache.length === 0) {
            tbody.innerHTML = '<tr><td colspan="7" class="text-center py-4 text-gray-500">Aucun produit trouvé</td></tr>';
            countElement.textContent = '0';
            countElement.classList.remove('hidden');
            console.warn('Aucun produit reçu de l\'API');
            return;
        }

        tbody.innerHTML = '';
        produitsCache.forEach(produit => {
            const numeroItem = parseInt(produit.BAR); // Convertir BAR en entier
            if (isNaN(numeroItem)) {
                console.warn(`BAR invalide pour produit ${produit.DESIGNATION}: ${produit.BAR}`);
                return;
            }
            const tr = document.createElement('tr');
            tr.className = 'hover:bg-gray-50';
            tr.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                    <button onclick="selectProduct(${numeroItem}, ${produit.PRIX}, ${produit.PRIXBA}, ${produit.QTE}, '${produit.DESIGNATION}')" class="bg-blue-600 text-white px-2 py-1 rounded-md hover:bg-blue-700 transition duration-300">
                        Sélectionner
                    </button>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${numeroItem}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${produit.BAR || 'N/A'}</td>
                <td class="px-6 py-4 text-sm text-gray-900">${produit.DESIGNATION || 'N/A'}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${parseFloat(produit.PRIX || 0).toFixed(2)}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${parseFloat(produit.PRIXBA || '0.00').toFixed(2)}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${produit.QTE || '0'}</td>
            `;
            tbody.appendChild(tr);
        });
        countElement.textContent = produitsCache.length;
        countElement.classList.remove('hidden');
        console.log(`Produits affichés: ${produitsCache.length}`);
    } catch (error) {
        document.getElementById('productsList').innerHTML = `
            <tr>
                <td colspan="7" class="text-center py-4 text-red-500">
                    Erreur de chargement: ${error.message}
                </td>
            </tr>
        `;
        console.error('Erreur produits:', error);
        showToast(`Erreur lors du chargement des produits: ${error.message}`, true);
    }
}

// Sélectionner un produit
function selectProduct(bar, prix, prixba, stock, designation) {
    console.log('Produit sélectionné:', bar, prix, prixba, stock, designation);
    const numeroItem = parseInt(bar); // Confirmer que c'est un entier
    if (isNaN(numeroItem)) {
        showToast('Code produit invalide (doit être un nombre)', true);
        return;
    }
    document.getElementById('saleProductBar').value = numeroItem;
    document.getElementById('saleUnitPrice').value = prix.toFixed(2);
    document.getElementById('salePricePurchase').value = prixba.toFixed(2);
    document.getElementById('saleProductBar').dataset.designation = designation;
    document.getElementById('saleProductBar').dataset.numeroItem = numeroItem; // Stocker numero_item

    const quantityInput = document.getElementById('saleQuantity');
    quantityInput.setAttribute('max', stock);
    if (stock <= 0) {
        showToast('Stock insuffisant pour ce produit', true);
        quantityInput.value = 0;
        document.getElementById('salePriceTotal').value = '0.00';
    } else {
        quantityInput.value = 1;
        updateTotalPrice();
    }

    showToast(`Produit sélectionné : ${designation}`);
}

// Recherche de produit
document.getElementById('searchProduct').addEventListener('input', function(e) {
    console.log('Recherche produit:', e.target.value);
    const searchTerm = e.target.value.toLowerCase();
    const tbody = document.getElementById('productsList');

    tbody.innerHTML = '';
    const filteredProducts = produitsCache.filter(produit =>
        produit.BAR.toString().includes(searchTerm) ||
        produit.DESIGNATION.toLowerCase().includes(searchTerm) ||
        parseFloat(produit.PRIX || 0).toFixed(2).includes(searchTerm) ||
        parseFloat(produit.PRIXBA || '0.00').toFixed(2).includes(searchTerm)
    );

    if (filteredProducts.length === 0) {
        tbody.innerHTML = '<tr><td colspan="7" class="text-center py-4 text-gray-500">Aucun produit trouvé</td></tr>';
        return;
    }

    filteredProducts.forEach(produit => {
        const numeroItem = parseInt(produit.BAR);
        if (isNaN(numeroItem)) {
            console.warn(`BAR invalide pour produit ${produit.DESIGNATION}: ${produit.BAR}`);
            return;
        }
        const tr = document.createElement('tr');
        tr.className = 'hover:bg-gray-50';
        tr.innerHTML = `
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                <button onclick="selectProduct(${numeroItem}, ${produit.PRIX}, ${produit.PRIXBA}, ${produit.QTE}, '${produit.DESIGNATION}')" class="bg-blue-600 text-white px-2 py-1 rounded-md hover:bg-blue-700 transition duration-300">
                    Sélectionner
                </button>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${numeroItem}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${produit.BAR || 'N/A'}</td>
            <td class="px-6 py-4 text-sm text-gray-900">${produit.DESIGNATION || 'N/A'}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${parseFloat(produit.PRIX || 0).toFixed(2)}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${parseFloat(produit.PRIXBA || '0.00').toFixed(2)}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${produit.QTE || '0'}</td>
        `;
        tbody.appendChild(tr);
    });
});
```

### Modifications déjà appliquées à `#tempSalesList`
Les changements précédents pour la grille temporaire des lignes de vente sont conservés :
- **Colonnes** : Actions, ID (`numero_item`), Produit, Code (`produit_bar`), Quantité, Prix Unitaire, Prix Total.
- **Code** : `ajouterLigneVente()`, `updateTempSalesTable()`, `validerVente()`, etc., utilisent `numero_item` comme entier.

### Explications des changements
1. **Correction de l'affichage des produits** :
   - **Logs ajoutés** :
     ```javascript
     console.log('Produits reçus:', produitsCache);
     console.log(`Produits affichés: ${produitsCache.length}`);
     ```
     - Aide à vérifier si `produitsCache` est vide ou mal formé.
   - **Gestion des erreurs** :
     ```javascript
     if (!produitsCache || produitsCache.length === 0) {
         tbody.innerHTML = '<tr><td colspan="7" class="text-center py-4 text-gray-500">Aucun produit trouvé</td></tr>';
         console.warn('Aucun produit reçu de l\'API');
         return;
     }
     ```
     - Affiche un message clair si l'API retourne une liste vide.
   - **Validation de `BAR`** :
     ```javascript
     const numeroItem = parseInt(produit.BAR);
     if (isNaN(numeroItem)) {
         console.warn(`BAR invalide pour produit ${produit.DESIGNATION}: ${produit.BAR}`);
         return;
     }
     ```
     - Ignore les produits avec un `BAR` non numérique.

2. **Ajout des colonnes "Actions" et "ID" dans `#productsList`** :
   - **Structure HTML** :
     ```html
     <tr>
         <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
         <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
         <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Code</th>
         <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Désignation</th>
         ...
     </tr>
     ```
     - "Actions" et "ID" sont ajoutées au début.
     - `colspan="7"` reflète les 7 colonnes.
   - **Rendu dans `chargerProduits()`** :
     ```javascript
     tr.innerHTML = `
         <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
             <button onclick="selectProduct(${numeroItem}, ${produit.PRIX}, ${produit.PRIXBA}, ${produit.QTE}, '${produit.DESIGNATION}')" class="bg-blue-600 text-white px-2 py-1 rounded-md hover:bg-blue-700 transition duration-300">
                 Sélectionner
             </button>
         </td>
         <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${numeroItem}</td>
         <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${produit.BAR || 'N/A'}</td>
         ...
     `;
     ```
     - "Actions" contient le bouton "Sélectionner".
     - "ID" affiche `numeroItem` (entier).
   - **Recherche** :
     - Mis à jour pour inclure les nouvelles colonnes et gérer `numeroItem`.

3. **Grille temporaire (#tempSalesList)** :
   - Conservée comme dans la réponse précédente :
     ```javascript
     tr.innerHTML = `
         <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
             <button onclick="supprimerLigne(${index})" class="bg-red-600 text-white px-2 py-1 rounded-md hover:bg-red-700 transition">
                 <i class="fas fa-trash"></i>
             </button>
         </td>
         <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${ligne.numero_item}</td>
         <td class="px-6 py-4 text-sm text-gray-900">${ligne.designation || 'N/A'}</td>
         <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${ligne.produit_bar || 'N/A'}</td>
         ...
     `;
     ```

### Instructions
1. **Déployer `vente.html`** :
   - Mets à jour `vente.html` avec les sections modifiées.
   - Déploie :
     ```bash
     git add vente.html
     git commit -m "Corriger affichage produits et ajouter Actions/ID dans productsList"
     git push origin main
     ```

2. **Vérifier l'API `/liste_produits`** :
   - Ouvre `https://hicham558.github.io/FIREPOZ/vente.html`.
   - Simule une connexion :
     ```javascript
     localStorage.setItem('userId', 'test_user_id');
     localStorage.setItem('userEmail', 'test@example.com');
     ```
   - Vérifie (F12 → Network → `/liste_produits`) :
     - **Headers** : Confirme que `X-User-ID: test_user_id` est envoyé.
     - **Response** : Attendu :
       ```json
       [
         {
           "BAR": "12225545854545",
           "DESIGNATION": "Coca Cola",
           "PRIX": 100.00,
           "PRIXBA": 80.00,
           "QTE": 100
         }
       ]
       ```
     - Si vide ou erreur (ex. : 401, 403), vérifie `app.py` :
       ```python
       @app.route('/liste_produits', methods=['GET'])
       def liste_produits():
           user_id = validate_user_id()
           if not isinstance(user_id, str):
               return user_id
           try:
               conn = get_conn()
               cur = conn.cursor(cursor_factory=RealDictCursor)
               cur.execute("SELECT BAR, DESIGNATION, PRIX, PRIXBA, qte FROM item")
               produits = cur.fetchall()
               cur.close()
               db_pool.putconn(conn)
               return jsonify(produits), 200
           except Exception as e:
               print(f"Erreur: {str(e)}")
               return jsonify({"error": str(e)}), 500
       ```
       - Ajoute un produit de test :
         ```sql
         INSERT INTO item (BAR, DESIGNATION, PRIX, PRIXBA, qte)
         VALUES (12225545854545, 'Coca Cola', 100.00, 80.00, 100)
         ON CONFLICT (BAR) DO UPDATE SET qte = 100, PRIX = 100.00, PRIXBA = 80.00, DESIGNATION = 'Coca Cola';
         ```

3. **Vérifier le schéma** :
   - Connecte-toi :
     ```bash
     psql -h roundhouse.proxy.rlwy.net -p 12999 -U postgres -d railway
     ```
   - Vérifie `item` :
     ```sql
     \d item
     ```
     - Confirme que `BAR` est `INTEGER` et `qte` est la colonne de stock.
     - Si `BAR` est `VARCHAR`, modifie :
       ```sql
       ALTER TABLE item ALTER COLUMN BAR TYPE INTEGER USING (BAR::INTEGER);
       ```

4. **Tester les produits disponibles** :
   - Vérifie la table `#productsList` :
     - **Colonnes** : Actions (bouton "Sélectionner"), ID (`12225545854545`), Code (`"12225545854545"`), Désignation, Prix Vente, Prix Achat, Stock.
     - Console (F12 → Console) :
       ```
       Produits reçus: [{BAR: "12225545854545", DESIGNATION: "Coca Cola", ...}]
       Produits affichés: 1
       ```
   - Si vide, partage :
     - Logs de la console (F12 → Console).
     - Réponse de `/liste_produits` (F12 → Network).

5. **Tester la grille temporaire** :
   - Ajoute un produit (ex. : `BAR=12225545854545`) :
     - Vérifie `#tempSalesList` :
       - **Actions** : Bouton supprimer.
       - **ID** : `12225545854545` (entier).
       - **Produit** : `Coca Cola`.
       - **Code** : `12225545854545` (chaîne).
     - Console :
       ```
       Ligne: {numero_item: 12225545854545, produit_bar: "12225545854545", designation: "Coca Cola", ...}
       ```
   - Valide la vente :
     - Vérifie (F12 → Network → `/valider_vente`) :
       - **Payload** :
         ```json
         {
           "numero_table": 0,
           "date_comande": "...",
           "nature": "vente",
           "lignes": [
             {
               "numero_item": 12225545854545,
               "quantite": 1,
               "prixt": 100.00,
               "remarque": "100.00",
               "prixbh": 80.00
             }
           ]
         }
         ```
       - **Response** : `{"numero_comande": 123}`
     - Logs Railway :
       ```
       Vente validée: numero_comande=123, 1 lignes
       ```

6. **Question sur les colonnes "ID" et "Code"** :
   - Dans les deux tables (`#productsList` et `#tempSalesList`), "ID" (`numero_item`, entier) et "Code" (`BAR` ou `produit_bar`, chaîne) affichent des valeurs similaires (`12225545854545`).
   - Veux-tu :
     - Supprimer la colonne "Code" dans l'une ou les deux tables pour éviter la redondance ?
     - Garder les deux colonnes pour une raison spécifique (ex. : "Code" comme référence visuelle) ?
   - Si tu veux supprimer "Code", je peux fournir une version ajustée.

### Réponse
- **Problème d'affichage** : Corrigé avec des logs et une gestion d'erreur robuste dans `chargerProduits()`.
- **Colonnes "Actions" et "ID"** :
  - Ajoutées au début de `#productsList` (Actions: bouton "Sélectionner", ID: `numero_item` entier).
  - Déjà présentes dans `#tempSalesList` (Actions: bouton supprimer, ID: `numero_item`).
- **Grille temporaire** : Conservée avec Actions, ID, Produit, Code, Quantité, Prix Unitaire, Prix Total.
- **Produits disponibles** : Maintenant Actions, ID, Code, Désignation, Prix Vente, Prix Achat, Stock.

### Prochaines étapes
1. **Déployer** :
   - Mets à jour `vente.html` avec les sections modifiées.
   - Déploie :
     ```bash
     git add vente.html
     git commit -m "Corriger affichage produits et ajouter Actions/ID dans productsList"
     git push origin main
     ```

2. **Tester** :
   - Ouvre `https://hicham558.github.io/FIREPOZ/vente.html`.
   - Vérifie `#productsList` :
     - Les produits s'affichent avec les colonnes Actions, ID, Code, etc.
     - ID montre `numero_item` (ex. : `12225545854545`).
   - Vérifie `#tempSalesList` après ajout d'un produit.
   - Partage :
     - Capture d’écran des deux tables.
     - Logs de la console (F12 → Console).
     - Réponse de `/liste_produits` et `/valider_vente` (F12 → Network).
     - Logs Railway.

3. **Confirmer le schéma** :
   - Vérifie `item.BAR` :
     ```sql
     \d item
     ```
   - Si `VARCHAR`, convertis en `INTEGER` ou signale pour ajuster.

4. **Décision sur "Code"** :
   - Confirme si tu veux supprimer la colonne "Code" dans `#productsList` et/ou `#tempSalesList`.

Si les produits ne s'affichent toujours pas ou si une erreur persiste, partage les logs de la console et la réponse de `/liste_produits`.
